## 下载gitlab-runner

```
helm repo add gitlab https://charts.gitlab.io
helm repo list
# 下载到本地
helm fetch gitlab/gitlab-runner
# 解压
tar xf gitlab-runner-0.45.0.tgz
```

## 配置 helm

```
vi gitlab-runner/values.yaml
# 只需要修改下面的两个配置即可
gitlabUrl: "https://jh-xiaomage.gitlab.cn"  #设置为自己的gitlab地址
runnerRegistrationToken: "sFV-HEkLC_NgH2vLALfG"  #填写对应的注册令牌
```

## 安装

```
# 创建命名空间
kubectl create ns devops

# 安装
helm install gitlab-runner ./gitlab-runner --values ./gitlab-runner/values.yaml -n devops

# 输出
root@kbmaster:~# helm install gitlab-runner ./gitlab-runner --values ./gitlab-runner/values.yaml 
NAME: gitlab-runner
LAST DEPLOYED: Wed Jul 12 15:31:09 2023
NAMESPACE: default
STATUS: deployed
REVISION: 1
TEST SUITE: None
NOTES:
Your GitLab Runner should now be registered against the GitLab instance reachable at: "http://git.hongyuan.com/"

Runner namespace "default" was found in runners.config template.
```

## helm 目录

```
root@kbmaster:~/gitlab-runner# tree
.
├── CHANGELOG.md
├── Chart.yaml
├── CONTRIBUTING.md
├── DEVELOPMENT.md
├── LICENSE
├── Makefile
├── NOTICE
├── README.md
├── templates
│   ├── configmap.yaml
│   ├── deployment.yaml
│   ├── _env_vars.tpl
│   ├── _helpers.tpl
│   ├── hpa.yaml
│   ├── NOTES.txt
│   ├── role-binding.yaml
│   ├── role.yaml
│   ├── secrets.yaml
│   ├── service-account.yaml
│   ├── servicemonitor.yaml
│   ├── service-session-server.yaml
│   └── service.yaml
└── values.yaml
```

```
quay.io/argoproj/argocd:v2.7.6
docker pull quay.mirrors.ustc.edu.cn/argoproj/argocd:v2.7.6
```
## 参考

- [在kubernetes安装gitlab-runner](https://juejin.cn/post/7148321080766103583)
- [配置GitLab Runner跑CI](https://note.qidong.name/2021/05/gitlab-runner/)