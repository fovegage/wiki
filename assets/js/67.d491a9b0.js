(window.webpackJsonp=window.webpackJsonp||[]).push([[67],{416:function(e,s,n){"use strict";n.r(s);var t=n(15),a=Object(t.a)({},(function(){var e=this,s=e._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[s("h2",{attrs:{id:"demo"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#demo"}},[e._v("#")]),e._v(" demo")]),e._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v('# 这里的代码和golang客户端基本是对齐的，java使用观察者模式进行数据的监听\nKV kvClient = etcdClient.getKVClient();\nLease leaseClient = etcdClient.getLeaseClient();\n\n\n// Generate a random value for the key\nString value = GetIP.getAddress() + ":" + port;\nlog.info("pod ip: " + value);\n\n// Create a new lease\nlong leaseId = leaseClient.grant(LEASE_TTL).get().getID();\n\n// signhub.algorithm.{site_name}.{action}/{lease_id}\nString[] joinKey = {"signhub", "algorithm", getGroup().toString().toLowerCase(), getAction().toString().toLowerCase()};\nString registerKey = String.join(".", joinKey);\nSystem.out.println(registerKey);\nByteSequence key = ByteSequence.from(registerKey + "/" + leaseId, StandardCharsets.UTF_8);\nByteSequence val = ByteSequence.from(value, StandardCharsets.UTF_8);\nkvClient.put(key, val).get();\n\nAtomicReference<io.etcd.jetcd.lease.LeaseKeepAliveResponse> resp = new AtomicReference<>();\nAtomicReference<Throwable> error = new AtomicReference<>();\n\nStreamObserver<io.etcd.jetcd.lease.LeaseKeepAliveResponse> observer = Observers.<LeaseKeepAliveResponse>builder()\n        .onNext(resp::set)\n        .onError(error::set)\n        .build();\n\nlong leaseID = leaseClient.grant(5, 10, TimeUnit.SECONDS).get().getID();\n\nkvClient.put(key, val, PutOption.newBuilder().withLeaseId(leaseID).build()).get();\n\nleaseClient.keepAlive(leaseID, observer);\n')])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br"),s("span",{staticClass:"line-number"},[e._v("3")]),s("br"),s("span",{staticClass:"line-number"},[e._v("4")]),s("br"),s("span",{staticClass:"line-number"},[e._v("5")]),s("br"),s("span",{staticClass:"line-number"},[e._v("6")]),s("br"),s("span",{staticClass:"line-number"},[e._v("7")]),s("br"),s("span",{staticClass:"line-number"},[e._v("8")]),s("br"),s("span",{staticClass:"line-number"},[e._v("9")]),s("br"),s("span",{staticClass:"line-number"},[e._v("10")]),s("br"),s("span",{staticClass:"line-number"},[e._v("11")]),s("br"),s("span",{staticClass:"line-number"},[e._v("12")]),s("br"),s("span",{staticClass:"line-number"},[e._v("13")]),s("br"),s("span",{staticClass:"line-number"},[e._v("14")]),s("br"),s("span",{staticClass:"line-number"},[e._v("15")]),s("br"),s("span",{staticClass:"line-number"},[e._v("16")]),s("br"),s("span",{staticClass:"line-number"},[e._v("17")]),s("br"),s("span",{staticClass:"line-number"},[e._v("18")]),s("br"),s("span",{staticClass:"line-number"},[e._v("19")]),s("br"),s("span",{staticClass:"line-number"},[e._v("20")]),s("br"),s("span",{staticClass:"line-number"},[e._v("21")]),s("br"),s("span",{staticClass:"line-number"},[e._v("22")]),s("br"),s("span",{staticClass:"line-number"},[e._v("23")]),s("br"),s("span",{staticClass:"line-number"},[e._v("24")]),s("br"),s("span",{staticClass:"line-number"},[e._v("25")]),s("br"),s("span",{staticClass:"line-number"},[e._v("26")]),s("br"),s("span",{staticClass:"line-number"},[e._v("27")]),s("br"),s("span",{staticClass:"line-number"},[e._v("28")]),s("br"),s("span",{staticClass:"line-number"},[e._v("29")]),s("br"),s("span",{staticClass:"line-number"},[e._v("30")]),s("br"),s("span",{staticClass:"line-number"},[e._v("31")]),s("br"),s("span",{staticClass:"line-number"},[e._v("32")]),s("br"),s("span",{staticClass:"line-number"},[e._v("33")]),s("br")])]),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("# etcd官方demo\nhttps://github.com/etcd-io/jetcd/blob/main/jetcd-core/src/test/java/io/etcd/jetcd/impl/LeaseTest.java\n\n# 文档\nhttps://github.com/kekingcn/kkbinlog/blob/master/%E6%B5%85%E6%9E%90jetcd%E4%B8%AD%E7%9A%84KeepAlive%E5%AE%9E%E7%8E%B0.md\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br"),s("span",{staticClass:"line-number"},[e._v("3")]),s("br"),s("span",{staticClass:"line-number"},[e._v("4")]),s("br"),s("span",{staticClass:"line-number"},[e._v("5")]),s("br")])])])}),[],!1,null,null,null);s.default=a.exports}}]);