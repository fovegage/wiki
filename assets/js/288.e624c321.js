(window.webpackJsonp=window.webpackJsonp||[]).push([[288],{633:function(s,n,e){"use strict";e.r(n);var a=e(15),r=Object(a.a)({},(function(){var s=this,n=s._self._c;return n("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[n("h2",{attrs:{id:"下载gitlab-runner"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#下载gitlab-runner"}},[s._v("#")]),s._v(" 下载gitlab-runner")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("helm repo add gitlab https://charts.gitlab.io\nhelm repo list\n# 下载到本地\nhelm fetch gitlab/gitlab-runner\n# 解压\ntar xf gitlab-runner-0.54.0.tgz\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br")])]),n("h2",{attrs:{id:"配置-helm"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#配置-helm"}},[s._v("#")]),s._v(" 配置 helm")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('vi gitlab-runner/values.yaml\n# 只需要修改下面的两个配置即可\ngitlabUrl: "https://jh-xiaomage.gitlab.cn"  #设置为自己的gitlab地址\nrunnerRegistrationToken: "sFV-HEkLC_NgH2vLALfG"  #填写对应的注册令牌\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br")])]),n("h2",{attrs:{id:"安装"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#安装"}},[s._v("#")]),s._v(" 安装")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('# 创建命名空间\nkubectl create ns devops\n\n# 安装\nhelm install gitlab-runner ./gitlab-runner --values ./gitlab-runner/values.yaml -n devops\n\n# 更新\nhelm upgrade  gitlab-runner gitlab-runner  -f ./gitlab-runner/values.yaml -n devops\n\n# 输出\nroot@kbmaster:~# helm install gitlab-runner ./gitlab-runner --values ./gitlab-runner/values.yaml \nNAME: gitlab-runner\nLAST DEPLOYED: Wed Jul 12 15:31:09 2023\nNAMESPACE: default\nSTATUS: deployed\nREVISION: 1\nTEST SUITE: None\nNOTES:\nYour GitLab Runner should now be registered against the GitLab instance reachable at: "http://git.hongyuan.com/"\n\nRunner namespace "default" was found in runners.config template.\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br")])]),n("h2",{attrs:{id:"配置权限"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#配置权限"}},[s._v("#")]),s._v(" 配置权限")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('vi gitlab-runner/values.yaml\n\n## GitLab Runner Image\ngitlabUrl: http://example.domain/\nrunnerRegistrationToken: "<token>"\n\nrbac:\n  create: true\n  rules:\n    - apiGroups: [""]\n      resources: ["pods"]\n      verbs: ["list", "get", "watch", "create", "delete"]\n    - apiGroups: [""]\n      resources: ["pods/exec"]\n      verbs: ["create"]\n    - apiGroups: [""]\n      resources: ["pods/log"]\n      verbs: ["get"]\n    - apiGroups: [""]\n      resources: ["pods/attach"]\n      verbs: ["list", "get", "create", "delete", "update"]\n    - apiGroups: [""]\n      resources: ["secrets"]\n      verbs: ["list", "get", "create", "delete", "update"]      \n    - apiGroups: [""]\n      resources: ["configmaps"]\n      verbs: ["list", "get", "create", "delete", "update"]      \n\nrunners:\n  privileged: true\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br")])]),n("h2",{attrs:{id:"k8s配置文件"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#k8s配置文件"}},[s._v("#")]),s._v(" k8s配置文件")]),s._v(" "),n("div",{staticClass:"language-yaml line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-yaml"}},[n("code",[n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("config")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("|")]),n("span",{pre:!0,attrs:{class:"token scalar string"}},[s._v('\n  [[runners]]\n    name = "runner"\n    url = "http://git.hongyuan.com/"\n    token = "xyMegqUefLfKz3dc7x7y"\n    executor = "kubernetes"\n    [runners.kubernetes]\n      namespace = "devops"\n      image = "ubuntu:22.04"\n      privileged = true\n      [runners.kubernetes.volumes]\n        [[runners.kubernetes.volumes.host_path]]\n          name = "docker-sock"\n          mount_path = "/var/run/docker.sock"\n          host_path = "/var/run/docker.sock"')]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br")])]),n("h2",{attrs:{id:"docker-配置文件"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#docker-配置文件"}},[s._v("#")]),s._v(" docker 配置文件")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('concurrent = 5\ncheck_interval = 5\n\n[session_server]\nsession_timeout = 1800\n\n[[runners]]\n  name = "spider-docker-runner"\n  url = "http://git.xxx.com/"\n  token = "xxx"\n  executor = "docker"\n  [runners.custom_build_dir]\n  [runners.cache]\n    Type = "s3"\n    Path = "prefix"\n    Shared = false\n  [runners.cache.s3]\n    ServerAddress = "10.6.16.32:31001"\n    AccessKey = "minioadmin"\n    SecretKey = "minioadmin"\n    BucketName = "gitlab-runner"\n    InSecure = true\n  [runners.docker]\n    tls_verify = false\n    image = "alpine:latest"\n    privileged = true\n    disable_entrypoint_overwrite = false\n    oom_kill_disable = false\n    disable_cache = false\n    volumes = ["/cache", "/var/run/docker.sock:/var/run/docker.sock", "/data/.m2/:/.m2/"]\n    pull_policy = "if-not-present"\n    shm_size = 0\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br")])]),n("h2",{attrs:{id:"helm-目录"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#helm-目录"}},[s._v("#")]),s._v(" helm 目录")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("root@kbmaster:~/gitlab-runner# tree\n.\n├── CHANGELOG.md\n├── Chart.yaml\n├── CONTRIBUTING.md\n├── DEVELOPMENT.md\n├── LICENSE\n├── Makefile\n├── NOTICE\n├── README.md\n├── templates\n│   ├── configmap.yaml\n│   ├── deployment.yaml\n│   ├── _env_vars.tpl\n│   ├── _helpers.tpl\n│   ├── hpa.yaml\n│   ├── NOTES.txt\n│   ├── role-binding.yaml\n│   ├── role.yaml\n│   ├── secrets.yaml\n│   ├── service-account.yaml\n│   ├── servicemonitor.yaml\n│   ├── service-session-server.yaml\n│   └── service.yaml\n└── values.yaml\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br")])]),n("h2",{attrs:{id:"优化"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#优化"}},[s._v("#")]),s._v(" 优化")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('# 配置minio缓存  （注意 minio两个端口 需要在数据端口，否则会存不进去）\n[runners.cache]\n  Type = "s3"\n  Path = "prefix"\n  Shared = false\n  [runners.cache.s3]\n    ServerAddress = "172.17.0.4:9000"\n    AccessKey = "12345678"\n    SecretKey = "87654321"\n    BucketName = "fizz-minio"\nInsecure = true\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br")])]),n("h2",{attrs:{id:"参数"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#参数"}},[s._v("#")]),s._v(" 参数")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("concurrent\t限制可以同时运行的作业数量\nlog_level\t日志级别\nlog_format\t日志格式\ncheck_interval\t检查新作业的间隔长度，默认为3秒\nsentry_dsn\t启用Sentry错误跟踪\nlisten_address\thttp服务监听地址\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br")])]),n("h2",{attrs:{id:"参考"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#参考"}},[s._v("#")]),s._v(" 参考")]),s._v(" "),n("ul",[n("li",[n("a",{attrs:{href:"https://todoit.tech/k8s/gitlab-runner/",target:"_blank",rel:"noopener noreferrer"}},[s._v("部署 GitLab Runner"),n("OutboundLink")],1)]),s._v(" "),n("li",[n("a",{attrs:{href:"https://www.jianshu.com/p/6decaed7b648",target:"_blank",rel:"noopener noreferrer"}},[s._v("GitLab-Runner配置参数详解"),n("OutboundLink")],1)]),s._v(" "),n("li",[n("a",{attrs:{href:"https://juejin.cn/post/7166171734754721829",target:"_blank",rel:"noopener noreferrer"}},[s._v("Go + Docker技巧-私人仓库和Gitlab CI"),n("OutboundLink")],1)]),s._v(" "),n("li",[n("a",{attrs:{href:"https://cloud.tencent.com/developer/article/1938818",target:"_blank",rel:"noopener noreferrer"}},[s._v("GitLab Runner 配置分布式缓存MinIO"),n("OutboundLink")],1)]),s._v(" "),n("li",[n("a",{attrs:{href:"https://docs.gitlab.cn/jh/ci/jobs/ci_job_token.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("极狐GitLab CI/CD 作业令牌"),n("OutboundLink")],1)]),s._v(" "),n("li",[n("a",{attrs:{href:"https://juejin.cn/post/7148321080766103583",target:"_blank",rel:"noopener noreferrer"}},[s._v("在kubernetes安装gitlab-runner"),n("OutboundLink")],1)]),s._v(" "),n("li",[n("a",{attrs:{href:"https://note.qidong.name/2021/05/gitlab-runner/",target:"_blank",rel:"noopener noreferrer"}},[s._v("配置GitLab Runner跑CI"),n("OutboundLink")],1)]),s._v(" "),n("li",[n("a",{attrs:{href:"https://stackoverflow.com/questions/69239098/not-able-to-execute-gitlab-runner-in-kubernetes-cluster-cannot-create-resource",target:"_blank",rel:"noopener noreferrer"}},[s._v('Not able to execute GitLab Runner in Kubernetes cluster: cannot create resource "secrets" in API group "" in the namespace "gitlab"'),n("OutboundLink")],1)])])])}),[],!1,null,null,null);n.default=r.exports}}]);