(window.webpackJsonp=window.webpackJsonp||[]).push([[305],{651:function(s,n,a){"use strict";a.r(n);var e=a(15),i=Object(e.a)({},(function(){var s=this,n=s._self._c;return n("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[n("h2",{attrs:{id:"demo"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#demo"}},[s._v("#")]),s._v(" demo")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('stages:\n  - jar\n  - build\n  - cd\n\nvariables:\n  MAVEN_OPTS: "-Dmaven.repo.local=.m2/repository"\n\ncache:\n  paths:\n    - .m2/repository\n\nbuild_jar:\n  stage: jar\n  image: maven:latest\n  before_script:\n    - echo \'<settings xmlns="http://maven.apache.org/SETTINGS/1.2.0"\n      xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"\n      xsi:schemaLocation="http://maven.apache.org/SETTINGS/1.2.0 https://maven.apache.org/xsd/settings-1.2.0.xsd">\n      <localRepository>/cache/.m2</localRepository>\n      <mirrors>\n      <mirror>\n      <id>nexus-aliyun</id>\n      <mirrorOf>*</mirrorOf>\n      <name>Nexus aliyun</name>\n      <url>http://maven.aliyun.com/nexus/content/groups/public</url>\n      </mirror>\n      </mirrors>\n      </settings>\' > $HOME/.m2/settings.xml\n  script:\n    - mvn clean package\n  artifacts:\n    paths:\n      - target/*.jar\n\nbuild_image:\n  stage: build\n  only:\n    - main\n    - dev\n  image: docker:stable\n  before_script:\n    - export IMAGE_TAG="registry.cn-beijing.aliyuncs.com/biyao/spider:${CI_COMMIT_SHA}"\n  script:\n    - ｜\n      cat > Dockerfile << __EOF__\n      FROM openjdk:8\n      EXPOSE 8080\n      ADD target/com.biyao.algorithmsign-0.9.8-SNAPSHOT.jar /releases/app/algorithmsign.jar\n      ADD target/com.biyao.browsersign-0.9.8-SNAPSHOT.jar /releases/app/browsersign.jar\n      ADD target/com.biyao.emulatesign-0.9.8-SNAPSHOT.jar /releases/app/emulatesign.jar\n      ADD target/com.biyao.hooksign-0.9.8-SNAPSHOT.jar /releases/app/hooksign.jar\n      ADD target/com.biyao.cdpsign-0.9.8-SNAPSHOT.jar /releases/app/cdpsign.jar\n      __EOF__\n    - echo $IMAGE_TAG\n    - echo "${ACR_PASSWORD}" | docker login registry.cn-beijing.aliyuncs.com -u ${ACR_USERNAME} --password-stdin\n    - docker build . --file Dockerfile --tag $IMAGE_TAG --build-arg "CI_JOB_TOKEN=${CI_JOB_TOKEN}" --build-arg "GITLAB_USERNAME=${GITLAB_USERNAME}" --build-arg "GITLAB_PASSWORD=${GITLAB_PASSWORD}"\n    - docker push $IMAGE_TAG\n\ncd-job:\n  stage: cd\n  image: smartive/kustomize\n  only:\n    - main\n    - dev\n  before_script:\n    - export IMAGE_TAG="registry.cn-beijing.aliyuncs.com/biyao/spider:${CI_COMMIT_SHA}"\n    - git config --global user.name gaozhe\n    - git config --global user.email gaozhe@idstaff.com\n    - git clone https://gitlab-cd:${CD_TOKEN}@git.hongyuan.com/spider/BiyaoCD.git\n  script:\n    - |\n      export ARGO_APP=$(echo $CI_PROJECT_NAME | tr \'[A-Z]\' \'[a-z]\')\n      echo "$ARGO_APP"\n      echo "print CI_COMMIT_TITLE"\n      echo "$CI_COMMIT_TITLE"\n      if [ -d "BiyaoCD/${ARGO_APP}/overlays" ]; then\n        cd BiyaoCD/${ARGO_APP}/overlays\n        # 发布到测试环境\n        if [[ "$CI_COMMIT_REF_NAME" != "main" ]]; then\n          if echo "$CI_COMMIT_TITLE" | grep -q "algorithmsign"; then\n            cd algorithmsign/dev && kustomize edit set image k8s_image=${IMAGE_TAG} && cd ../../\n          elif echo "$CI_COMMIT_TITLE" | grep -q "browsersign"; then\n            cd browsersign/dev && kustomize edit set image k8s_image=${IMAGE_TAG} && cd ../../\n          elif echo "$CI_COMMIT_TITLE" | grep -q "cdpsign"; then\n            cd cdpsign/dev && kustomize edit set image k8s_image=${IMAGE_TAG} && cd ../../\n          elif echo "$CI_COMMIT_TITLE" | grep -q "hooksign"; then\n            cd hooksign/dev && kustomize edit set image k8s_image=${IMAGE_TAG} && cd ../../\n          elif echo "$CI_COMMIT_TITLE" | grep -q "emulatesign"; then\n            cd emulatesign/dev && kustomize edit set image k8s_image=${IMAGE_TAG} && cd ../../\n          else\n            echo "Please select branch";\n            exit 1;\n          fi\n        fi\n\n        # 发布到生产环境\n        if [ "$CI_COMMIT_REF_NAME" == "main" ]; then\n          if echo "$CI_COMMIT_TITLE" | grep -q "algorithmsign"; then\n            cd algorithmsign/prod && kustomize edit set image k8s_image=${IMAGE_TAG} && cd ../../\n          elif echo "$CI_COMMIT_TITLE" | grep -q "browsersign"; then\n            cd browsersign/prod && kustomize edit set image k8s_image=${IMAGE_TAG} && cd ../../\n          elif echo "$CI_COMMIT_TITLE" | grep -q "cdpsign"; then\n            cd cdpsign/prod && kustomize edit set image k8s_image=${IMAGE_TAG} && cd ../../\n          elif echo "$CI_COMMIT_TITLE" | grep -q "hooksign"; then\n            cd hooksign/prod && kustomize edit set image k8s_image=${IMAGE_TAG} && cd ../../\n          elif echo "$CI_COMMIT_TITLE" | grep -q "emulatesign"; then\n            cd emulatesign/prod && kustomize edit set image k8s_image=${IMAGE_TAG} && cd ../../\n          else\n            echo "Please select branch";\n            exit 1;\n          fi      \n        fi\n        git add .\n        git commit -m "CD: update ${ARGO_APP}: ${IMAGE_TAG}"\n        git fetch && git rebase origin/main && git push\n      fi\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br"),n("span",{staticClass:"line-number"},[s._v("39")]),n("br"),n("span",{staticClass:"line-number"},[s._v("40")]),n("br"),n("span",{staticClass:"line-number"},[s._v("41")]),n("br"),n("span",{staticClass:"line-number"},[s._v("42")]),n("br"),n("span",{staticClass:"line-number"},[s._v("43")]),n("br"),n("span",{staticClass:"line-number"},[s._v("44")]),n("br"),n("span",{staticClass:"line-number"},[s._v("45")]),n("br"),n("span",{staticClass:"line-number"},[s._v("46")]),n("br"),n("span",{staticClass:"line-number"},[s._v("47")]),n("br"),n("span",{staticClass:"line-number"},[s._v("48")]),n("br"),n("span",{staticClass:"line-number"},[s._v("49")]),n("br"),n("span",{staticClass:"line-number"},[s._v("50")]),n("br"),n("span",{staticClass:"line-number"},[s._v("51")]),n("br"),n("span",{staticClass:"line-number"},[s._v("52")]),n("br"),n("span",{staticClass:"line-number"},[s._v("53")]),n("br"),n("span",{staticClass:"line-number"},[s._v("54")]),n("br"),n("span",{staticClass:"line-number"},[s._v("55")]),n("br"),n("span",{staticClass:"line-number"},[s._v("56")]),n("br"),n("span",{staticClass:"line-number"},[s._v("57")]),n("br"),n("span",{staticClass:"line-number"},[s._v("58")]),n("br"),n("span",{staticClass:"line-number"},[s._v("59")]),n("br"),n("span",{staticClass:"line-number"},[s._v("60")]),n("br"),n("span",{staticClass:"line-number"},[s._v("61")]),n("br"),n("span",{staticClass:"line-number"},[s._v("62")]),n("br"),n("span",{staticClass:"line-number"},[s._v("63")]),n("br"),n("span",{staticClass:"line-number"},[s._v("64")]),n("br"),n("span",{staticClass:"line-number"},[s._v("65")]),n("br"),n("span",{staticClass:"line-number"},[s._v("66")]),n("br"),n("span",{staticClass:"line-number"},[s._v("67")]),n("br"),n("span",{staticClass:"line-number"},[s._v("68")]),n("br"),n("span",{staticClass:"line-number"},[s._v("69")]),n("br"),n("span",{staticClass:"line-number"},[s._v("70")]),n("br"),n("span",{staticClass:"line-number"},[s._v("71")]),n("br"),n("span",{staticClass:"line-number"},[s._v("72")]),n("br"),n("span",{staticClass:"line-number"},[s._v("73")]),n("br"),n("span",{staticClass:"line-number"},[s._v("74")]),n("br"),n("span",{staticClass:"line-number"},[s._v("75")]),n("br"),n("span",{staticClass:"line-number"},[s._v("76")]),n("br"),n("span",{staticClass:"line-number"},[s._v("77")]),n("br"),n("span",{staticClass:"line-number"},[s._v("78")]),n("br"),n("span",{staticClass:"line-number"},[s._v("79")]),n("br"),n("span",{staticClass:"line-number"},[s._v("80")]),n("br"),n("span",{staticClass:"line-number"},[s._v("81")]),n("br"),n("span",{staticClass:"line-number"},[s._v("82")]),n("br"),n("span",{staticClass:"line-number"},[s._v("83")]),n("br"),n("span",{staticClass:"line-number"},[s._v("84")]),n("br"),n("span",{staticClass:"line-number"},[s._v("85")]),n("br"),n("span",{staticClass:"line-number"},[s._v("86")]),n("br"),n("span",{staticClass:"line-number"},[s._v("87")]),n("br"),n("span",{staticClass:"line-number"},[s._v("88")]),n("br"),n("span",{staticClass:"line-number"},[s._v("89")]),n("br"),n("span",{staticClass:"line-number"},[s._v("90")]),n("br"),n("span",{staticClass:"line-number"},[s._v("91")]),n("br"),n("span",{staticClass:"line-number"},[s._v("92")]),n("br"),n("span",{staticClass:"line-number"},[s._v("93")]),n("br"),n("span",{staticClass:"line-number"},[s._v("94")]),n("br"),n("span",{staticClass:"line-number"},[s._v("95")]),n("br"),n("span",{staticClass:"line-number"},[s._v("96")]),n("br"),n("span",{staticClass:"line-number"},[s._v("97")]),n("br"),n("span",{staticClass:"line-number"},[s._v("98")]),n("br"),n("span",{staticClass:"line-number"},[s._v("99")]),n("br"),n("span",{staticClass:"line-number"},[s._v("100")]),n("br"),n("span",{staticClass:"line-number"},[s._v("101")]),n("br"),n("span",{staticClass:"line-number"},[s._v("102")]),n("br"),n("span",{staticClass:"line-number"},[s._v("103")]),n("br"),n("span",{staticClass:"line-number"},[s._v("104")]),n("br"),n("span",{staticClass:"line-number"},[s._v("105")]),n("br"),n("span",{staticClass:"line-number"},[s._v("106")]),n("br"),n("span",{staticClass:"line-number"},[s._v("107")]),n("br"),n("span",{staticClass:"line-number"},[s._v("108")]),n("br"),n("span",{staticClass:"line-number"},[s._v("109")]),n("br"),n("span",{staticClass:"line-number"},[s._v("110")]),n("br"),n("span",{staticClass:"line-number"},[s._v("111")]),n("br"),n("span",{staticClass:"line-number"},[s._v("112")]),n("br"),n("span",{staticClass:"line-number"},[s._v("113")]),n("br"),n("span",{staticClass:"line-number"},[s._v("114")]),n("br"),n("span",{staticClass:"line-number"},[s._v("115")]),n("br"),n("span",{staticClass:"line-number"},[s._v("116")]),n("br"),n("span",{staticClass:"line-number"},[s._v("117")]),n("br")])]),n("h2",{attrs:{id:"参考"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#参考"}},[s._v("#")]),s._v(" 参考")]),s._v(" "),n("ul",[n("li",[n("a",{attrs:{href:"https://blog.csdn.net/chen_hao_181/article/details/123559055",target:"_blank",rel:"noopener noreferrer"}},[s._v("GitLab CI/CD maven项目加速"),n("OutboundLink")],1)])])])}),[],!1,null,null,null);n.default=i.exports}}]);