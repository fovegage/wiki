(window.webpackJsonp=window.webpackJsonp||[]).push([[302],{649:function(t,a,s){"use strict";s.r(a);var n=s(15),e=Object(n.a)({},(function(){var t=this,a=t._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h2",{attrs:{id:"说明"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#说明"}},[t._v("#")]),t._v(" 说明")]),t._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("1. 国内网络不建议使用kaniko构建（https://blog.51cto.com/zhangxueliang/5073004）\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br")])]),a("h2",{attrs:{id:"配置文件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#配置文件"}},[t._v("#")]),t._v(" 配置文件")]),t._v(" "),a("div",{staticClass:"language-yaml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("build-job")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("stage")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" build\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("image")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" changingai/kaniko"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("executor\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("entrypoint")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('""')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("before_script")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(' export IMAGE_TAG="registry.cn'),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("beijing.aliyuncs.com/xxx/spider"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v('$CI_COMMIT_SHORT_SHA"\n  '),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("script")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" mkdir "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("p /kaniko/.docker\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(' echo "'),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v('\\"auths\\"'),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v('\\"$'),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("CI_REGISTRY"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v('\\"'),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v('\\"auth\\"'),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v('\\"$(printf "%s'),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v('%s" "$'),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("CI_REGISTRY_USER"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v('" "$'),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("CI_REGISTRY_PASSWORD"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v('" '),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("|")]),t._v(" base64 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("|")]),t._v(" tr "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("d '\\n')\\\""),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v('\\"registry.cn'),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v('beijing.aliyuncs.com\\"'),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v('\\"auth\\"'),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v('\\"$(printf "%s'),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v('%s" username@qq.com password '),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("|")]),t._v(" base64 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("|")]),t._v(" tr "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("d '\\n')\\\""),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v('" '),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")]),t._v(" /kaniko/.docker/config.json\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" /kaniko/executor "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v('context "$'),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("CI_PROJECT_DIR"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v('" '),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v('dockerfile "$'),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("CI_PROJECT_DIR"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v('/Dockerfile" '),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v('destination "$'),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("IMAGE_TAG"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v('" '),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("build"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v('arg "CI_JOB_TOKEN=$'),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("CI_JOB_TOKEN"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v('"\n    '),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(' echo "Docker Push Success'),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" IMAGE_TAG "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("$"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("IMAGE_TAG"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v('"\n')])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br"),a("span",{staticClass:"line-number"},[t._v("11")]),a("br"),a("span",{staticClass:"line-number"},[t._v("12")]),a("br")])]),a("h2",{attrs:{id:"参考"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#参考"}},[t._v("#")]),t._v(" 参考")]),t._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"https://blog.51cto.com/zhangxueliang/5073004",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://blog.51cto.com/zhangxueliang/5073004"),a("OutboundLink")],1)]),t._v(" "),a("li",[a("a",{attrs:{href:"https://juejin.cn/post/7217665415710081081",target:"_blank",rel:"noopener noreferrer"}},[t._v("一文带你玩转Kaniko从此不用docker build"),a("OutboundLink")],1)]),t._v(" "),a("li",[a("a",{attrs:{href:"https://docs.gitlab.cn/jh/ci/docker/using_kaniko.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("使用 kaniko 构建 Docker 镜像"),a("OutboundLink")],1)]),t._v(" "),a("li",[a("a",{attrs:{href:"https://docs.gitlab.cn/jh/user/packages/dependency_proxy/index.html#authenticate-within-cicd",target:"_blank",rel:"noopener noreferrer"}},[t._v("Dependency Proxy"),a("OutboundLink")],1)])])])}),[],!1,null,null,null);a.default=e.exports}}]);